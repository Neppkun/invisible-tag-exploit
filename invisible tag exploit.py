import requests
import sys
import os
import time
import os.path
import json

class SendMessage:

    def __init__(self, token, channel, message, hidden_message):
        self.token = token
        self.channel_id = channel
        self.message = message
        self.hidden_message = hidden_message
        self.headers = {'Authorization': token}

    def inject(self, m1, m2):
        return m1 + ('||\u200b||' * 200) + m2

    def execute(self):
        return requests.post(f'https://discordapp.com/api/v6/channels/{self.channel_id}/messages', headers=self.headers, json={'content': self.inject(self.message, self.hidden_message)})
    
def main():
    jsonexist = os.path.exists('pingexp.txt')
    if jsonexist is False:
        token = input("Enter your token: ")
        if len(token) < 7:
            print("That isn't a valid token.")
            time.sleep(1)
            os.system('cls' if os.name == 'nt' else 'clear')
            main()
        else:
            savetoken = input("Would you like to save your token for future uses? [Y/N]: ")
            if savetoken.lower() == ("y"):
                jsonfile = open('pingexp.txt', 'w')
                jsonfile.write(token)
                print('Your token was saved successfully!')
            channel_id = input("Enter channel id: ")
            message = input("Enter your message: ")
            hidden_message = input("Enter the hidden text/tag: ")

            exploit = SendMessage(token, channel_id, message, hidden_message)

            exploit.execute()
    
            os.system('cls' if os.name == 'nt' else 'clear')
            print("Message sent to channel " + channel_id + " (Use CTRL + C to exit the program.)")
            main()
            
    elif jsonexist is True:
        with open('pingexp.txt') as tokenfile:
            var = tokenfile.read()
            if len(var) < 7:
                print("The token in the file is corrupted or wrong. Please delete the file and re-run the program.")
            else:
                print("Looks like your token is already saved.")
                channel_id = input("Enter channel id: ")
                message = input("Enter your message: ")
                hidden_message = input("Enter the hidden text/tag: ")
                token = var
    

                exploit = SendMessage(token, channel_id, message, hidden_message)

                exploit.execute()
    
                os.system('cls' if os.name == 'nt' else 'clear')
                print("Message sent to channel " + channel_id + " (Use CTRL + C to exit the program.)")
                main()


if __name__ == '__main__':
    main()
